'use strict';const a47_0x4bc0b2=a47_0x3bcd;function a47_0x41cb(){const _0x5ee732=['defineProperty','error','296blQynN','publishEventClub','convertUserIDToUUID','toString','__esModule','serialNo','accessCode','function','846936uRzyVr','79713WRIUJJ','stringify','object','PubSubService','event_subtype','__metadata','getDate','PubSub','event_type','getSeconds','532172Ahlwml','getFullYear','projects/bepass-platform/topics/palmeiras-game-entrance','logger','96804dWtaNf','name','storageService','projects/bepass-platform/topics/clube-palmeiras-user-exit','StorageService','451FWubqp','topic','./storage.service','40621PzmnPt','false','__decorate','getTimeStamp','visitor','@nestjs/common','Logger','metadata','true','publishEventUserExit','4oXnfWS','userIdFormatted','@google-cloud/pubsub','783990ZmCYUw','330ATSoFE','getOwnPropertyDescriptor','10lJCGKU','publishMessage','length','insertString','log','decorate','from','captureException','8612efiKjG','projects/bepass-platform/topics/clube-palmeiras-user-entrance','substr','parse'];a47_0x41cb=function(){return _0x5ee732;};return a47_0x41cb();}function a47_0x3bcd(_0x71fc21,_0x44c285){const _0x41cb03=a47_0x41cb();return a47_0x3bcd=function(_0x3bcdac,_0x489ad0){_0x3bcdac=_0x3bcdac-0x1e7;let _0x3dc5a9=_0x41cb03[_0x3bcdac];return _0x3dc5a9;},a47_0x3bcd(_0x71fc21,_0x44c285);}(function(_0x56c7a4,_0x46f5f3){const _0x5e11d3=a47_0x3bcd,_0x19aa14=_0x56c7a4();while(!![]){try{const _0x387670=-parseInt(_0x5e11d3(0x20f))/0x1*(parseInt(_0x5e11d3(0x201))/0x2)+parseInt(_0x5e11d3(0x21d))/0x3+parseInt(_0x5e11d3(0x1eb))/0x4*(parseInt(_0x5e11d3(0x207))/0x5)+-parseInt(_0x5e11d3(0x204))/0x6+parseInt(_0x5e11d3(0x1f7))/0x7*(-parseInt(_0x5e11d3(0x215))/0x8)+parseInt(_0x5e11d3(0x21e))/0x9*(parseInt(_0x5e11d3(0x205))/0xa)+-parseInt(_0x5e11d3(0x1f4))/0xb*(parseInt(_0x5e11d3(0x1ef))/0xc);if(_0x387670===_0x46f5f3)break;else _0x19aa14['push'](_0x19aa14['shift']());}catch(_0x56e0bb){_0x19aa14['push'](_0x19aa14['shift']());}}}(a47_0x41cb,0x23f84));var __decorate=this&&this[a47_0x4bc0b2(0x1f9)]||function(_0x35792e,_0x15005,_0x1228af,_0x3601da){const _0x57e6fa=a47_0x4bc0b2;var _0x45e860=arguments[_0x57e6fa(0x209)],_0x54b48c=_0x45e860<0x3?_0x15005:_0x3601da===null?_0x3601da=Object[_0x57e6fa(0x206)](_0x15005,_0x1228af):_0x3601da,_0x17514e;if(typeof Reflect==='object'&&typeof Reflect[_0x57e6fa(0x20c)]===_0x57e6fa(0x21c))_0x54b48c=Reflect[_0x57e6fa(0x20c)](_0x35792e,_0x15005,_0x1228af,_0x3601da);else{for(var _0x5c6d6c=_0x35792e[_0x57e6fa(0x209)]-0x1;_0x5c6d6c>=0x0;_0x5c6d6c--)if(_0x17514e=_0x35792e[_0x5c6d6c])_0x54b48c=(_0x45e860<0x3?_0x17514e(_0x54b48c):_0x45e860>0x3?_0x17514e(_0x15005,_0x1228af,_0x54b48c):_0x17514e(_0x15005,_0x1228af))||_0x54b48c;}return _0x45e860>0x3&&_0x54b48c&&Object['defineProperty'](_0x15005,_0x1228af,_0x54b48c),_0x54b48c;},__metadata=this&&this[a47_0x4bc0b2(0x223)]||function(_0x1fc6ce,_0x42d6ab){const _0x58cadd=a47_0x4bc0b2;if(typeof Reflect===_0x58cadd(0x220)&&typeof Reflect['metadata']===_0x58cadd(0x21c))return Reflect[_0x58cadd(0x1fe)](_0x1fc6ce,_0x42d6ab);},PubSubService_1;Object[a47_0x4bc0b2(0x213)](exports,a47_0x4bc0b2(0x219),{'value':!![]}),exports[a47_0x4bc0b2(0x221)]=void 0x0;const common_1=require(a47_0x4bc0b2(0x1fc)),pubsub_1=require(a47_0x4bc0b2(0x203)),storage_service_1=require(a47_0x4bc0b2(0x1f6)),Sentry=require('@sentry/node');let PubSubService=PubSubService_1=class PubSubService{constructor(_0x5eaf83){const _0x57f9fd=a47_0x4bc0b2;this[_0x57f9fd(0x1f1)]=_0x5eaf83,this['logger']=new common_1[(_0x57f9fd(0x1fd))](PubSubService_1[_0x57f9fd(0x1f0)]);}[a47_0x4bc0b2(0x20a)](_0x4c71f8,_0x2669a1,_0x16c04b){const _0x428e05=a47_0x4bc0b2;return _0x4c71f8['substr'](0x0,_0x2669a1)+_0x16c04b+_0x4c71f8[_0x428e05(0x211)](_0x2669a1);}[a47_0x4bc0b2(0x217)](_0x5117f4){const _0x269c91=a47_0x4bc0b2;return _0x5117f4=this['insertString'](_0x5117f4,0x8,'-'),_0x5117f4=this['insertString'](_0x5117f4,0xd,'-'),_0x5117f4=this[_0x269c91(0x20a)](_0x5117f4,0x12,'-'),_0x5117f4=this[_0x269c91(0x20a)](_0x5117f4,0x17,'-'),_0x5117f4;}[a47_0x4bc0b2(0x1fa)](){const _0x47b659=a47_0x4bc0b2,_0x307c8f=new Date();return''+_0x307c8f[_0x47b659(0x1ec)]()+_0x307c8f['getMonth']()+_0x307c8f[_0x47b659(0x1e7)]()+_0x307c8f['getHours']()+_0x307c8f['getMinutes']()+_0x307c8f[_0x47b659(0x1ea)]();}async[a47_0x4bc0b2(0x216)](_0x1dcad9){const _0x3f4b4f=a47_0x4bc0b2;try{_0x1dcad9[_0x3f4b4f(0x1e9)]=_0x1dcad9[_0x3f4b4f(0x1e9)][_0x3f4b4f(0x218)](),_0x1dcad9[_0x3f4b4f(0x222)]=_0x1dcad9[_0x3f4b4f(0x222)][_0x3f4b4f(0x218)](),_0x1dcad9['accessCode']=_0x1dcad9['accessCode'][_0x3f4b4f(0x218)](),_0x1dcad9['userIdFormatted']=_0x1dcad9[_0x3f4b4f(0x202)]||_0x1dcad9[_0x3f4b4f(0x21b)][_0x3f4b4f(0x218)](),_0x1dcad9[_0x3f4b4f(0x21a)]=_0x1dcad9['serialNo'][_0x3f4b4f(0x218)](),this['logger']['log'](_0x1dcad9);const _0x2f5691=new pubsub_1[(_0x3f4b4f(0x1e8))](),_0x22d1f7=await _0x2f5691[_0x3f4b4f(0x1f5)](_0x3f4b4f(0x210))[_0x3f4b4f(0x208)]({'attributes':JSON[_0x3f4b4f(0x212)](JSON['stringify'](_0x1dcad9)),'data':Buffer[_0x3f4b4f(0x20d)](JSON[_0x3f4b4f(0x21f)](_0x1dcad9)),'messageId':this[_0x3f4b4f(0x1fa)](),'orderingKey':this[_0x3f4b4f(0x1fa)]()});this['logger'][_0x3f4b4f(0x20b)](_0x22d1f7);}catch(_0x22d2a0){Sentry['captureException'](_0x22d2a0),this[_0x3f4b4f(0x1ee)][_0x3f4b4f(0x214)](_0x22d2a0);}}async['publishEventGame'](_0xf10d69){const _0x55bf07=a47_0x4bc0b2;try{this[_0x55bf07(0x1ee)][_0x55bf07(0x20b)](_0xf10d69),_0xf10d69[_0x55bf07(0x1e9)]=_0xf10d69['event_type'][_0x55bf07(0x218)](),_0xf10d69['event_subtype']=_0xf10d69['event_subtype']['toString'](),_0xf10d69[_0x55bf07(0x21b)]=_0xf10d69[_0x55bf07(0x21b)]['toString'](),_0xf10d69[_0x55bf07(0x202)]=_0xf10d69[_0x55bf07(0x202)]||_0xf10d69[_0x55bf07(0x21b)]['toString'](),_0xf10d69['serialNo']=_0xf10d69[_0x55bf07(0x21a)][_0x55bf07(0x218)]();const _0x43bc79=new pubsub_1[(_0x55bf07(0x1e8))](),_0xa5f5ff=await _0x43bc79[_0x55bf07(0x1f5)](_0x55bf07(0x1ed))[_0x55bf07(0x208)]({'attributes':JSON[_0x55bf07(0x212)](JSON['stringify'](_0xf10d69)),'data':Buffer[_0x55bf07(0x20d)](JSON[_0x55bf07(0x21f)](_0xf10d69)),'messageId':this[_0x55bf07(0x1fa)](),'orderingKey':this[_0x55bf07(0x1fa)]()});this[_0x55bf07(0x1ee)]['log'](_0xa5f5ff);}catch(_0xc01584){Sentry[_0x55bf07(0x20e)](_0xc01584),this[_0x55bf07(0x1ee)][_0x55bf07(0x214)](_0xc01584);}}async[a47_0x4bc0b2(0x200)](_0x51b5cc,_0x8cbfaf,_0x57558f,_0x31a696){const _0x2c157f=a47_0x4bc0b2;this[_0x2c157f(0x1ee)]['log'](_0x2c157f(0x200));const _0x5ac1bd=new pubsub_1[(_0x2c157f(0x1e8))](),_0x31c2e9=await _0x5ac1bd[_0x2c157f(0x1f5)](_0x2c157f(0x1f2))[_0x2c157f(0x208)]({'attributes':{'userId':this[_0x2c157f(0x217)](_0x51b5cc),'accessCode':_0x31a696[_0x2c157f(0x218)](),'IP':_0x57558f,'isVisitor':_0x31a696===_0x2c157f(0x1fb)?_0x2c157f(0x1ff)['toString']():_0x2c157f(0x1f8)['toString'](),'timestamp':this[_0x2c157f(0x1fa)]()},'messageId':this[_0x2c157f(0x1fa)](),'orderingKey':this['getTimeStamp']()});this[_0x2c157f(0x1ee)][_0x2c157f(0x20b)](_0x31c2e9);}};PubSubService=PubSubService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata('design:paramtypes',[storage_service_1[a47_0x4bc0b2(0x1f3)]])],PubSubService),exports[a47_0x4bc0b2(0x221)]=PubSubService;